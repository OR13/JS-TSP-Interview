var TSPI;!function(t){var i;!function(t){"use strict";var i=function(){function t(t){t.date=new Date}return t.$inject=["$scope"],t}();t.NavbarCtrl=i}(i=t.Controllers||(t.Controllers={}))}(TSPI||(TSPI={}));var TSPI;!function(TSPI){var Controllers;!function(Controllers){"use strict";var InterviewController=function(){function InterviewController($scope){var _this=this;this.runIterations=function(){return _this.iteration>=_this.maxIterations?void console.info("Done: ",_this):(_this.salesman=new TSPI.TSPISalesman,_this.salesman.getPathToAllCities(_this.map,_this.iteration),(_this.salesman.currentPathDistance<_this.shortestPathDistance||-1==_this.shortestPathDistance)&&(_this.shortestPath=new TSPI.TSPIPath(_this.salesman.currentPath,_this.salesman.currentPathDistance,_this.iteration),_this.selectedPath=_this.shortestPath,_this.shortestPathDistance=_this.shortestPath.distance,_this.shortestPaths.push(_this.shortestPath),_this.salesman.rankCities()),_this.iteration++,_this.scope.safeApply(),void setTimeout(_this.runIterations,1e3/_this.iterationsPerSecond))},this.run=function(){console.log("running ",_this),_this.iteration=0,eval(_this.aceModel.toString()),_this.runIterations()},this.selectPath=function(t){_this.selectedPath=t},this.isActivePath=function(t){return _this.selectedPath==t},this.reload=function(){console.log("reloading ",_this),_this.iteration=0,_this.shortestPathDistance=-1,_this.shortestPath=null,_this.shortestPaths=[],_this.map=new TSPI.TSPIMap(_this.numCities)},this.iteration=0,this.maxIterations=100,this.shortestPathDistance=-1,this.shortestPath=null,this.shortestPaths=[],this.iterationsPerSecond=5,this.numCities=8,this.map=new TSPI.TSPIMap(this.numCities),this.scope=$scope,$scope.safeApply=function(t){var i=this.$root.$$phase;"$apply"==i||"$digest"==i?t&&"function"==typeof t&&t():this.$apply(t)},this.aceOptions={useWrapMode:!0,showGutter:!1,theme:"twilight",mode:"javascript",firstLineNumber:5,onLoad:function(t){t.setReadOnly(!1),t.$blockScrolling=1/0},onChange:function(){}},this.aceModel="\n\n// A salesmen always travels to the city with the highest score.\n// Distance is the distance from the salesman's current city to the city being scored.\n// Rank is 1 + the number of salesmen who have found a shortest path passing through the city being scored.\n// Iteration is the number of salesmen who have tried to find a shortest path.\n\nwindow.scoreCity = function(distance, rank, iteration){\n\n    if (iteration === 0) {\n        return 1 / distance;\n    }\n\n    var rand = Math.random();\n\n    if (rand > .5) {\n        return rank * (Math.random() * 20) / distance;\n    } else {\n        return (1 / distance) * rank;\n    }\n\n}\n\n"}return InterviewController.$inject=["$scope"],InterviewController}();Controllers.InterviewController=InterviewController}(Controllers=TSPI.Controllers||(TSPI.Controllers={}))}(TSPI||(TSPI={}));var TSPI;!function(t){"use strict";var i=function(){function t(){this.currentPath=[],this.currentPathDistance=0,this.isWinner=!1}return t.prototype.updateRemainingCitiesFrom=function(t){var i=this;this.remainingCities=_.filter(t.cities,function(t){return!_.contains(i.currentPath,t)})},t.prototype.getPathToAllCities=function(t,i){var e=t.cities[Math.floor(Math.random()*t.cities.length)];for(this.travelToCity(e),this.updateRemainingCitiesFrom(t);0!==this.remainingCities.length;){var n=this.smartlyChooseNextCity(this.remainingCities,i);this.travelToCity(n),this.updateRemainingCitiesFrom(t)}return this.travelToCity(this.currentPath[0]),this.currentPath},t.prototype.travelToCity=function(t){0===this.currentPath.length?(this.currentPath.push(t),this.currentPathDistance=0):(this.currentPathDistance+=this.currentCity.getDistanceFrom(t),this.currentPath.push(t)),this.currentCity=this.currentPath[this.currentPath.length-1]},t.prototype.rankCities=function(){this.currentPath.forEach(function(t){t.promote()})},t.prototype.smartlyChooseNextCity=function(t,i){var e=this,n=t[Math.floor(Math.random()*t.length)],r=this.scoreCityCandidate(n,i),s=n;return t.forEach(function(t){var n=e.scoreCityCandidate(t,i);n>r&&(s=t,r=n)}),s},t.prototype.scoreCityCandidate=function(t,i){var e=t.getDistanceFrom(this.currentCity);return window.scoreCity(e,t.rank,i)},t}();t.TSPISalesman=i}(TSPI||(TSPI={}));var TSPI;!function(t){"use strict";var i=function(){function i(i){this.cities=[];for(var e=function(t,i){return Math.random()*(i-t)+1+t},n=$(".tspi-map")[0].offsetWidth-50,r=0;i>r;r++){var s=new t.TSPICity(r,"City "+r,"Its Description","black",e(9,n),e(8,248));this.cities.push(s)}}return i}();t.TSPIMap=i}(TSPI||(TSPI={}));var TSPI;!function(t){var i;!function(t){"use strict";function i(){return{restrict:"E",scope:!0,template:'<div id="tspi-map-container"></div>',replace:!0,link:function(t){var i=$(".tspi-map")[0].offsetWidth;t.ui={},t.ui.svgContainer=d3.select("#tspi-map-container").append("svg"),t.ui.svgContainer.attr("width",i).attr("height",256),t.ui.drawCities=function(){t.ui.svgContainer.selectAll("line").remove(),t.ui.svgContainer.selectAll("circle").remove(),t.ui.svgContainer.selectAll("circle").data(t.$parent.InterviewController.map.cities).enter().append("circle").attr("cx",function(t){return t.x_axis}).attr("cy",function(t){return t.y_axis}).attr("r",function(){return 5}).style("fill",function(t){return t.color})},t.ui.drawPath=function(i){t.ui.svgContainer.selectAll("line").remove();for(var e=0;e<i.length-1;e++){var n=i[e],r=i[e+1];t.ui.svgContainer.append("line").style("stroke","black").attr("x1",n.x_axis).attr("y1",n.y_axis).attr("x2",r.x_axis).attr("y2",r.y_axis)}},t.$parent.$watch("InterviewController.map.cities",function(){t.ui.drawCities()}),t.$parent.$watch("InterviewController.selectedPath",function(i){i&&t.ui.drawPath(i.cities)})}}}t.tspiMap=i}(i=t.Directives||(t.Directives={}))}(TSPI||(TSPI={}));var TSPI;!function(t){"use strict";var i=function(){function t(t,i,e,n,r,s){var a=this;void 0===t&&(t=0),void 0===i&&(i="default city"),void 0===e&&(e="description"),void 0===n&&(n="purple"),void 0===r&&(r=50),void 0===s&&(s=50),this.getDistanceFrom=function(t){var i=t.x_axis-a.x_axis,e=t.y_axis-a.y_axis,n=Math.sqrt(Math.pow(i,2)+Math.pow(e,2));return n},this.promote=function(){a.rank++},this.cityId=t,this.name=i,this.rank=0,this.description=e,this.color=n,this.x_axis=r,this.y_axis=s}return t}();t.TSPICity=i}(TSPI||(TSPI={}));var TSPI;!function(t){"use strict";var i=function(){function t(t,i,e){void 0===t&&(t=[]),void 0===i&&(i=-1),void 0===e&&(e=0),this.cities=t,this.distance=i,this.iteration=e}return t}();t.TSPIPath=i}(TSPI||(TSPI={}));var TSPI;!function(t){"use strict";angular.module("TSPI",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngResource","ui.router","ui.bootstrap","ui.sortable","ui.ace","firebase"]).controller(t.Controllers).directive(t.Directives).config(["$locationProvider","$stateProvider","$urlRouterProvider",function(t,i,e){t.html5Mode(!0),i.state("interview",{url:"/interview",templateUrl:"app/interview/interview.html",controller:"InterviewController",controllerAs:"InterviewController"}),e.otherwise("/interview")}])}(TSPI||(TSPI={})),angular.module("TSPI").run(["$templateCache",function(t){t.put("app/interview/interview.html",'<div class="container"><div class="col-sm-9 col-md-9 col-lg-9"><tspi-map style="margin-top: 64px;" map="InterviewController.map" class="tspi-map col-sm-12 col-md-12 col-lg-12"></tspi-map><div ui-ace="InterviewController.aceOptions" ng-model="InterviewController.aceModel" class="col-sm-12 col-md-12 col-lg-12"></div></div><div class="col-sm-3 col-md-3 col-lg-3"><form class="form-inline" style="margin-top: 64px;"><button class="btn btn-primary" ng-click="InterviewController.run()"><i class="fa fa-gear"></i> Run Program</button> <button class="btn btn-danger pull-right" ng-click="InterviewController.reload()"><i class="fa fa-refresh"></i> Reset Map</button><div class="input-group" style="margin-top: 36px; margin-bottom: 36px;"><div class="input-group-addon">Max Iterations</div><input type="number" class="form-control" ng-model="InterviewController.maxIterations"></div><div class="input-group" style="margin-bottom: 36px;"><div class="input-group-addon">Num Cities</div><input type="number" class="form-control" ng-model="InterviewController.numCities"></div><div class="input-group" style="margin-bottom: 36px;"><div class="input-group-addon">Iterations / Second</div><input type="number" class="form-control" ng-model="InterviewController.iterationsPerSecond"></div></form><div class="tspi-metrics" ng-hide="InterviewController.shortestPath"><h3>Ants & Salesmen</h3><p class="">In this variation on the classic traveling salesman problem, we seek to define a heuristic function \'scoreCity\', used by a salesman at each city to determine which of the remaining cities to travel to next.</p></div><div class="tspi-metrics" ng-show="InterviewController.shortestPath"><table class="table table-bordered table-striped table-hover"><tr><th>Iteration</th><th>Distance</th></tr><tr ng-repeat="path in InterviewController.shortestPaths" ng-click="InterviewController.selectPath(path)" ng-class="{\'active\': InterviewController.isActivePath(path)}"><td>{{path.iteration}}</td><td>{{path.distance }}</td></tr></table><p class="text-center"><small>{{InterviewController.iteration}} of {{InterviewController.maxIterations}}</small></p></div><ul class="list-group"><li class="list-group-item"><a href="https://en.wikipedia.org/wiki/Travelling_salesman_problem" target="_blank"><i class="fa fa-book"></i> Traveling Salesman</a></li><li class="list-group-item"><a href="http://www.math.uwaterloo.ca/tsp/" target="_blank"><i class="fa fa-book"></i> U. Waterloo TSP</a></li><li class="list-group-item"><a href="https://en.wikipedia.org/wiki/Ant_colony_optimization_algorithms" target="_blank"><i class="fa fa-book"></i> Ant Colony Optimization</a></li></ul></div></div>'),t.put("app/components/footer/footer.html",'<div class="footer"><ul class="nav nav-pills"><li ui-sref-active="active" role="presentation"><a ui-sref="typescript"><i class="fa fa-windows"></i> TypeScript</a></li><li ui-sref-active="active" role="presentation"><a ui-sref="coffeescript"><i class="fa fa-coffee"></i> CoffeeScript</a></li><li ui-sref-active="active" role="presentation"><a ui-sref="developer-features"><i class="fa fa-code"></i> Dev Features</a></li><li role="presentation"><a href="https://github.com/OR13/TSPI" target="_blank"><i class="fa fa-github"></i> View Source</a></li></ul></div>'),t.put("app/components/navbar/navbar.html",'<nav class="navbar navbar-static-top navbar-default" ng-controller="NavbarCtrl"><div class="container"><div class="navbar-header"><a class="navbar-brand" href="/"><span class="fa fa-life-bouy"></span> TypeScript + CoffeeScript</a></div></div></nav>')}]);